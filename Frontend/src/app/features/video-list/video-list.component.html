<div class="page">
  <!-- TITLE -->
  <h1 class="title">Movie Searcher</h1>

  <!-- LOADING / ERROR -->
  @if (loading$ | async) {
  <div class="info">Loading videos...</div>
  } @if (error$ | async; as error) {
  <div class="info error">{{ error }}</div>
  }

  <!-- FILTER -->
  <div class="filter-row">
    <input type="text" placeholder="Title" [(ngModel)]="filters.title" />

    <input type="text" placeholder="Genre" [(ngModel)]="filters.genre" />

    <input
      type="number"
      placeholder="Min rating"
      [(ngModel)]="filters.minImdbRating"
      min="0"
      max="10"
      step="0.1"
    />

    <input
      type="number"
      placeholder="Year from"
      [(ngModel)]="filters.releaseYearFrom"
      min="1900"
      max="2100"
    />

    <input
      type="number"
      placeholder="Year to"
      [(ngModel)]="filters.releaseYearTo"
      min="1900"
      max="2100"
    />

    <button type="button" (click)="applyFilters()">Search</button>
    <button type="button" class="clear-btn" (click)="clearFilters()">Clear</button>
  </div>

  <div class="marquee" [class.marquee--scroll]="shouldScroll">
    <div class="marquee-inner">
      @for (video of (videos$ | async) ?? []; track video.id) {
      <div class="card" (click)="openPreview(video)">
        <div class="thumb-wrapper">
          @if (video.thumbnailUrl) {
          <img [src]="video.thumbnailUrl" [alt]="video.title" />
          } @if (video.imdbRating) {
          <div class="rating">⭐ {{ video.imdbRating }}</div>
          }
        </div>

        <div class="card-body">
          <h2 class="card-title">{{ video.title }}</h2>

          <div class="meta-row">
            @if (video.category) {
            <span>{{ video.category }}</span>
            } @if (video.genre) {
            <span>• {{ video.genre }}</span>
            } @if (video.releaseYear) {
            <span>• {{ video.releaseYear }}</span>
            }
          </div>

          @if (video.language) {
          <div class="meta-row">Language: {{ video.language }}</div>
          } @if (video.description) {
          <p class="desc">{{ video.description }}</p>
          } @if (video.mainCast) {
          <p class="cast"><strong>Cast:</strong> {{ video.mainCast }}</p>
          }
        </div>
      </div>
      }

      <!-- DUPLICATED LIST: ONLY IF shouldScroll TRUE -->
      @if (shouldScroll) { @for (video of (videos$ | async) ?? []; track 'dup-' + video.id) {
      <div class="card" (click)="openPreview(video)">
        <div class="thumb-wrapper">
          @if (video.thumbnailUrl) {
          <img [src]="video.thumbnailUrl" [alt]="video.title" />
          } @if (video.imdbRating) {
          <div class="rating">⭐ {{ video.imdbRating }}</div>
          }
        </div>

        <div class="card-body">
          <h2 class="card-title">{{ video.title }}</h2>

          <div class="meta-row">
            @if (video.category) {
            <span>{{ video.category }}</span>
            } @if (video.genre) {
            <span>• {{ video.genre }}</span>
            } @if (video.releaseYear) {
            <span>• {{ video.releaseYear }}</span>
            }
          </div>

          @if (video.language) {
          <div class="meta-row">Language: {{ video.language }}</div>
          } @if (video.description) {
          <p class="desc">{{ video.description }}</p>
          } @if (video.mainCast) {
          <p class="cast"><strong>Cast:</strong> {{ video.mainCast }}</p>
          }
        </div>
      </div>
      } }
    </div>
  </div>

  @if (selectedVideo && selectedVideoSafeUrl) {
  <div class="backdrop" (click)="closePreview()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">{{ selectedVideo.title }}</h2>
        <button class="close-btn" type="button" (click)="closePreview()">✕</button>
      </div>

      <div class="video-wrapper">
        <iframe
          [src]="selectedVideoSafeUrl"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        >
        </iframe>
      </div>
    </div>
  </div>
  }
</div>
